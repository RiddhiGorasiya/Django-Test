{% extends 'myapp/base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="container mt-4">
    <h3 class="mb-4">Welcome, {{ user.username }} ({{ role }})</h3>

    <!-- Filter + Range Form -->
    <form method="GET" class="row mb-4">
        <div class="col-md-3">
            <input type="text" name="search" class="form-control" placeholder="Search by name/email" value="{{ search }}">
        </div>
        <div class="col-md-2">
            <input type="number" name="id_min" class="form-control" placeholder="Min ID" value="{{ id_min }}">
        </div>
        <div class="col-md-2">
            <input type="number" name="id_max" class="form-control" placeholder="Max ID" value="{{ id_max }}">
        </div>
        <div class="col-md-3">
            <select name="sort" class="form-select">
                <option value="id" {% if sort_field == 'id' %}selected{% endif %}>Sort by ID</option>
                <option value="name" {% if sort_field == 'name' %}selected{% endif %}>Sort by Name</option>
                <option value="email" {% if sort_field == 'email' %}selected{% endif %}>Sort by Email</option>
                <option value="role" {% if sort_field == 'role' %}selected{% endif %}>Sort by Role</option>
            </select>
        </div>
        <div class="col-md-2">
            <select name="order" class="form-select">
                <option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
                <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
            </select>
        </div>
        <div class="col-md-12 mt-3">
            <button class="btn btn-outline-primary">Apply</button>
        </div>
    </form>

    {% if role in "Admin Project Manager" %}
    <div class="card p-3 mb-4">
        <h5>Add New User</h5>
        <form method="POST">
            {% csrf_token %}
            {{ form.as_p }}
            <button class="btn btn-success">Add User</button>
        </form>
    </div>
    {% endif %}

    <div class="card shadow p-3">
        <h5>User List</h5>
        <table class="table table-bordered table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Password</th>
                    <th>Image</th>
                    <th>Role</th>
                    {% comment %} {% if role != "Developer" %} {% endcomment %}
                    <th>Action</th>
                    {% comment %} {% endif %} {% endcomment %}
                </tr>
            </thead>
            <tbody>
                {% for st in stu %}
                <tr>
                    <td>{{ st.id }}</td>
                    <td>{{ st.name }}</td>
                    <td>{{ st.email }}</td>
                    <td>{{ st.password }}</td>
                    <td>{{ st.image }}</td>
                    <td>{{ st.role }}</td>
                    {% comment %} {% if role != "Developer" %} {% endcomment %}
                    <td>
                        <a href="{% url 'updatedata' st.id %}" class="btn btn-warning btn-sm">Edit</a>
                    {% if role != "Developer" %}
                        <form action="{% url 'deletedata' st.id %}" method="POST" style="display:inline;">
                            {% csrf_token %}
                            <button class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </td>
                    {% endif %}
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center">No records found.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        <nav>
            <ul class="pagination justify-content-center">
                {% if stu.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ stu.previous_page_number }}&{{ preserved_query }}">Previous</a>
                </li>
                {% endif %}

                {% for i in stu.paginator.page_range %}
                <li class="page-item {% if stu.number == i %}active{% endif %}">
                    <a class="page-link" href="?page={{ i }}&{{ preserved_query }}">{{ i }}</a>
                </li>
                {% endfor %}

                {% if stu.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ stu.next_page_number }}&{{ preserved_query }}">Next</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
{% endblock %}

